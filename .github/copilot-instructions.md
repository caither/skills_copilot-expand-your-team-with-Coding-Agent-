## Development Environment

有關詳細的設定和開發說明，請參閱我們的[Development Guide]。(../docs/how-to-develop.md).

### 使用者互動（User Interaction）

與工作人員溝通時，請注意以下事項：

* 工作人員**不具技術背景**。請盡可能用簡單易懂的方式說明，避免使用軟體或技術術語。
* 任何新增的程式碼都必須**容易維護與理解**，即使沒有太多程式經驗也能看懂。

## 程式架構（Program architecture）

* 網站使用者是學生與老師，請確保使用體驗簡單直覺。
* 不要另外建立其他應用程式或服務。
* 不要製作命令列工具（Command Line Tools）。
* 不要建立單一且很長的檔案式應用程式。務必使用**清楚、容易理解的資料夾結構**來組織程式。
* **只能使用 HTML、CSS、JavaScript、Python**，不可使用其他程式語言。

## 通用文件框架（Universal Documentation Framework）

**請隨時維護以下產出文件（artifacts）：**

* **`requirements.md`**：以結構化 **EARS 表示法**撰寫的使用者故事與驗收標準。
* **`design.md`**：技術架構、流程圖（sequence diagrams）、實作考量。
* **`tasks.md`**：詳細且可追蹤的實作計畫。

**文件規則：**
所有文件必須以「詳細模板」作為**唯一且主要的事實來源（primary source of truth）**。所有文件撰寫語言以繁體中文為優先，必要時加入英文。

**摘要格式：**
僅用於簡短產出物，例如變更紀錄（changelog）與 pull request 說明。

### 詳細文件模板（Detailed Documentation Templates）

#### 行動文件模板（Action Documentation Template，適用於所有步驟／執行／測試）

```
### [TYPE] - [ACTION] - [TIMESTAMP]
**Objective**: [正在完成的目標]
**Context**: [目前狀態、需求，以及與前一步驟的關聯]
**Decision**: [選擇的作法與理由，如適用請引用 Decision Record]
**Execution**: [實際執行的步驟、參數與指令；若為程式碼，請包含檔案路徑]
**Output**: [完整且未刪減的結果、日誌、指令輸出與量測數據]
**Validation**: [成功驗證方式與結果；若失敗，需包含修復計畫]
**Next**: [銜接至下一個具體行動的自動延續計畫]
```

#### 決策紀錄模板（Decision Record Template，適用於所有決策）

```
### Decision - [TIMESTAMP]
**Decision**: [做出的決策內容]
**Context**: [需要決策的情境與相關數據]
**Options**: [評估過的替代方案，附簡要優缺點]
**Rationale**: [為何選擇此方案，需明確說明取捨]
**Impact**: [對實作、可維護性與效能的預期影響]
**Review**: [重新檢視此決策的條件或時程]
```

### 摘要格式（用於報告）

#### 精簡行動紀錄（Streamlined Action Log）

用於產生簡短的變更紀錄。每一筆紀錄皆源自完整的 Action 文件。

`[TYPE][TIMESTAMP] Goal: [X] → Action: [Y] → Result: [Z] → Next: [W]`

#### 壓縮版決策紀錄（Compressed Decision Record）

用於 pull request 摘要或管理層摘要。

`Decision: [X] | Rationale: [Y] | Impact: [Z] | Review: [Date]`

## 執行工作流程（6 階段循環）

**不可跳過任何步驟。請使用一致術語，降低歧義。**

### **階段 1：ANALYZE（分析）**

**目標：**

* 理解問題。
* 分析現有系統。
* 產出清楚、可測試的需求。
* 思考可能的解決方案及其影響。

**檢查清單：**

* [ ] 閱讀所有提供的程式碼、文件、測試與日誌。
  - 記錄檔案清單、摘要與初步分析結果。
* [ ] 使用 **EARS 表示法**定義需求：
  - 將功能需求轉換為結構化、可測試的需求。
* [ ] 辨識相依性與限制條件。
  - 記錄相依關係圖，包含風險與因應策略。
* [ ] 繪製資料流與互動關係。
  - 記錄系統互動圖與資料模型。
* [ ] 彙整邊界情況與失敗案例。
  - 建立完整的邊界情況矩陣與潛在失敗點。
* [ ] 評估信心程度。
  - 依需求清晰度、複雜度與問題範圍產生 **信心分數（0–100%）**。
  - 記錄分數與評估理由。

**關鍵限制：**

* **在所有需求明確且完成文件化之前，不得進入下一階段。**

### **階段 2：DESIGN（設計）**

**目標：**

* 建立完整的技術設計與詳細實作計畫。

**檢查清單：**

* [ ] **依信心分數制定調適型執行策略：**
  * **高信心（>85%）**
    * 擬定完整、逐步的實作計畫。
    * 略過概念驗證（PoC）。
    * 直接進行完整、自動化實作。
    * 維持標準且完整的文件。
  * **中等信心（66–85%）**
    * 優先進行 **PoC** 或 **MVP**。
    * 定義明確的 PoC／MVP 成功標準。
    * 先建置並驗證 PoC／MVP，再逐步擴充計畫。
    * 文件化 PoC／MVP 的目標、執行與驗證結果。
  * **低信心（<66%）**
    * 第一階段專注於研究與知識建立。
    * 使用語意搜尋並分析相似實作。
    * 將研究成果彙整成文件。
    * 研究完成後重新執行 ANALYZE 階段。
    * 若信心仍偏低，才進行升級處理。

* [ ] **在 `design.md` 中記錄技術設計：**
  * **架構**：元件與互動的高階概覽。
  * **資料流**：圖表與說明。
  * **介面**：API 合約、Schema、對外函式簽章。
  * **資料模型**：資料結構與資料庫 Schema。

* [ ] **記錄錯誤處理機制：**
  * 建立錯誤矩陣，包含處理流程與預期回應。

* [ ] **定義單元測試策略。**

* [ ] **在 `tasks.md` 中建立實作計畫：**
  * 每個任務需包含描述、預期成果與相依關係。

**關鍵限制：**

* **在設計與計畫完成且驗證前，不得進入實作。**

### **階段 3：IMPLEMENT（實作）**

**目標：**

* 依照設計與計畫撰寫可上線品質的程式碼。

**檢查清單：**

* [ ] 以小且可測試的增量方式撰寫程式碼。
  - 每個增量都需記錄程式變更、結果與測試連結。
* [ ] 依相依性由下而上實作。
  - 記錄處理順序、理由與驗證方式。
* [ ] 遵循既有慣例。
  - 若有偏離，需以 Decision Record 記錄。
* [ ] 撰寫有意義的註解。
  - 著重於「為什麼（why）」，而非「做了什麼（what）」。
* [ ] 依計畫建立檔案。
  - 記錄檔案建立紀錄。
* [ ] 即時更新任務狀態。

**關鍵限制：**

* **在所有實作步驟完成文件化並通過測試前，不得合併或部署程式碼。**

### **階段 4：VALIDATE（驗證）**

**目標：**

* 確認實作符合所有需求與品質標準。

**檢查清單：**

* [ ] 執行自動化測試。
  - 記錄輸出、日誌與覆蓋率報告。
  - 若失敗，需記錄根因分析與修復方案。
* [ ] 視需要進行人工驗證。
  - 記錄流程、檢查清單與結果。
* [ ] 測試邊界情況與錯誤。
  - 記錄結果與正確錯誤處理的證據。
* [ ] 驗證效能。
  - 記錄效能指標並分析關鍵區段。
* [ ] 紀錄執行追蹤。
  - 記錄路徑分析與執行期行為。

**關鍵限制：**

* **在所有驗證完成且問題全數解決前，不得進入下一階段。**

### **階段 5：REFLECT（回顧）**

**目標：**

* 改善程式碼、更新文件並分析效能。

**檢查清單：**

* [ ] 為可維護性進行重構。
  - 記錄決策、前後對照與影響。
* [ ] 更新所有專案文件。
  - 確保所有 README、圖表與註解為最新。
* [ ] 辨識潛在改善項目。
  - 建立並排序待辦清單（backlog）。
* [ ] 驗證成功標準。
  - 記錄最終驗證矩陣。
* [ ] 進行後設分析（meta-analysis）。
  - 回顧效率、工具使用與流程遵循度。
* [ ] 自動建立技術債 issue。
  - 記錄清單與修復計畫。

**關鍵限制：**

* **在所有文件與改善行動完成記錄前，不得結束此階段。**

### **階段 6：HANDOFF（交付）**

**目標：**

* 封裝成果供審查與部署，並銜接至下一任務。

**檢查清單：**

* [ ] 產生管理摘要。
  - 使用 **Compressed Decision Record** 格式。
* [ ] 準備 pull request（如適用）：
  1. 管理摘要。
  2. 由 **Streamlined Action Log** 產生的變更紀錄。
  3. 驗證產出與 Decision Records 的連結。
  4. 最終版 `requirements.md`、`design.md`、`tasks.md` 連結。
* [ ] 完成工作區整理。
  - 將中間檔案、日誌與暫存產出封存至 `.agent_work/`。
* [ ] 進入下一任務。
  - 記錄轉換或完成狀態。

**關鍵限制：**

* **在所有交付步驟完成並完成文件化前，不得視任務為完成。**

## 疑難排解與重試流程（Troubleshooting & Retry Protocol）

**若遇到錯誤、不明確事項或阻礙：**

**檢查清單：**

1. **重新分析（Re-analyze）：**
   * 回到 ANALYZE 階段。
   * 確認所有需求與限制清楚且完整。
2. **重新設計（Re-design）：**
   * 回到 DESIGN 階段。
   * 視需要更新技術設計、計畫或相依關係。
3. **重新規劃（Re-plan）：**
   * 調整 `tasks.md` 中的實作計畫以反映新發現。
4. **重新執行（Retry execution）：**
   * 以修正後的參數或邏輯重新執行失敗步驟。
5. **升級處理（Escalate）：**
   * 若多次重試後仍無法解決，依升級流程處理。

**關鍵限制：**

* **在錯誤或歧義未解決前，絕不可繼續。所有排錯步驟與結果都必須文件化。**

## 技術債管理（自動化）

### 辨識與文件化

* **程式碼品質**：在實作期間持續以靜態分析評估程式碼品質。
* **捷徑行為**：所有「以速度換品質」的決策都必須以 Decision Record 明確記錄其後果。
* **工作區**：監控結構漂移與命名不一致問題。
* **文件**：追蹤不完整、過期或缺失的文件。

### 自動建立 Issue 模板

```
**Title**: [Technical Debt] - [簡要說明]
**Priority**: [High/Medium/Low，依商業影響與修復成本]
**Location**: [檔案路徑與行號]
**Reason**: [產生技術債的原因，如有請連結 Decision Record]
**Impact**: [目前與未來的影響（例如降低開發速度、提高錯誤風險）]
**Remediation**: [具體、可執行的修復步驟]
**Effort**: [修復工作量估計（例如 T-shirt size：S、M、L）]
```

### 修復策略（自動排序）

* 依風險進行優先排序並分析相依關係。
* 提供工作量估計以利未來規劃。
* 為大型重構提出遷移策略。

## 品質保證（自動化）

### 持續監控

* **靜態分析**：檢查程式碼風格、品質、安全性漏洞與架構規則遵循度。
* **動態分析**：在測試環境中監控執行期行為與效能。
* **文件**：自動檢查文件完整性與正確性（例如連結與格式）。

### 品質指標（自動追蹤）

* 程式碼覆蓋率與缺口分析。
* 每個函式／方法的循環複雜度（Cyclomatic Complexity）。
* 可維護性指數（Maintainability Index）。
* 技術債比例（例如預估修復時間 vs. 開發時間）。
* 文件覆蓋率（例如有註解的公開方法比例）。

